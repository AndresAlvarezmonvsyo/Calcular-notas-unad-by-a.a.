<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="author" content="Julian Andres Alvarez">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Calculadora Premium UNAD</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
    :root {
        --primary-color: #0b4237;
        --primary-light: #0d5a4c;
        --secondary-color: #f5a623;
        --accent-color: #e74c3c;
        --light-color: #f9f9f9;
        --dark-color: #2c3e50;
        --success-color: #27ae60;
        --info-color: #3498db;
        --text-light: #ecf0f1;
        --text-dark: #2c3e50;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Poppins', sans-serif;
        line-height: 1.6;
        color: var(--text-dark);
        background-color: #f5f7fa;
        padding: 0;
        margin: 0;
        overflow-x: hidden;
    }

    .top-bar {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        color: white;
        padding: 15px 0;
        box-shadow: var(--shadow);
        position: relative;
        z-index: 1000;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .logo {
        display: flex;
        align-items: center;
        text-decoration: none;
        color: white;
    }

    .logo img {
        height: 70px;
        margin-right: 15px;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    }

    .logo-text {
        display: flex;
        flex-direction: column;
    }

    .logo-text span:first-child {
        font-size: 24px;
        font-weight: 700;
        line-height: 1;
    }

    .logo-text span:last-child {
        font-size: 14px;
        opacity: 0.8;
    }

    .student-note {
        font-size: 12px;
        margin-top: 5px;
        color: rgba(255,255,255,0.8);
        font-style: italic;
    }

    .theme-switch {
        display: flex;
        align-items: center;
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 30px;
        margin-left: 10px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: var(--transition);
        border-radius: 34px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: var(--transition);
        border-radius: 50%;
    }

    input:checked + .slider {
        background-color: var(--secondary-color);
    }

    input:checked + .slider:before {
        transform: translateX(30px);
    }

    .main-content {
        padding: 30px 20px 120px;
        min-height: calc(100vh - 180px);
        max-width: 1400px;
        margin: 0 auto;
    }

    .content-tab {
        display: none;
    }

    .content-tab.active {
        display: block;
        animation: fadeIn 0.5s ease;
    }

    .calculator-card {
        background: white;
        border-radius: 15px;
        box-shadow: var(--shadow);
        overflow: hidden;
        margin: 0 auto 30px;
        transition: var(--transition);
        width: 100%;
        max-width: 900px;
    }

    .calculator-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    }

    .card-header {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        color: white;
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .card-header h2 {
        font-size: 24px;
        font-weight: 600;
        margin: 0;
    }

    .card-header i {
        font-size: 28px;
        opacity: 0.8;
    }

    .card-body {
        padding: 30px;
    }

    .calculator-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
    }

    .input-group {
        margin-bottom: 20px;
    }

    .input-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--dark-color);
    }

    .input-wrapper {
        position: relative;
    }

    .input-wrapper input {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        transition: var(--transition);
        background-color: #f9f9f9;
    }

    .input-wrapper input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(11, 66, 55, 0.2);
        outline: none;
        background-color: white;
    }

    .input-wrapper .max-label {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: var(--primary-color);
        color: white;
        padding: 2px 8px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
    }

    .error-message {
        color: var(--accent-color);
        font-size: 12px;
        margin-top: 5px;
        display: none;
    }

    .progress-container {
        margin: 25px 0;
    }

    .progress-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
    }

    .progress-bar-bg {
        height: 10px;
        background: #e0e0e0;
        border-radius: 5px;
        overflow: hidden;
    }

    .progress-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        width: 0%;
        transition: width 0.5s ease, background 0.3s;
        border-radius: 5px;
    }

    .results-container {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 25px;
        margin-top: 0;
    }

    .result-item {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #e0e0e0;
    }

    .result-item:last-child {
        border-bottom: none;
    }

    .result-label {
        font-weight: 500;
    }

    .result-value {
        font-weight: 600;
        font-size: 18px;
    }

    .final-grade-container {
        text-align: center;
        margin-top: 30px;
        padding: 25px;
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        color: white;
        border-radius: 10px;
        box-shadow: var(--shadow);
        position: relative;
        overflow: hidden;
    }

    .final-grade-container::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
        animation: rotate 20s linear infinite;
    }

    .final-grade-title {
        font-size: 18px;
        margin-bottom: 10px;
        position: relative;
    }

    .final-grade-value {
        font-size: 48px;
        font-weight: 700;
        margin: 15px 0;
        position: relative;
        text-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }

    .success {
        color: var(--success-color);
    }

    .warning {
        color: var(--secondary-color);
    }

    .danger {
        color: var(--accent-color);
    }

    .final-grade-message {
        font-size: 16px;
        opacity: 0.9;
        position: relative;
    }

    .chart-container {
        margin-top: 30px;
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: var(--shadow);
        width: 100%;
    }

    .chart-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 15px;
        color: var(--primary-color);
        display: flex;
        align-items: center;
    }

    .chart-title i {
        margin-right: 10px;
        color: var(--secondary-color);
    }

    .guide-container {
        margin-top: 40px;
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: var(--shadow);
    }

    .guide-title {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 20px;
        color: var(--primary-color);
        display: flex;
        align-items: center;
    }

    .guide-title i {
        margin-right: 10px;
        color: var(--secondary-color);
    }

    .guide-steps {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }

    .guide-step {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: var(--shadow);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }

    .guide-step:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0,0,0,0.1);
    }

    .step-number {
        background: var(--primary-color);
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        margin-bottom: 15px;
    }

    .step-content {
        position: relative;
        z-index: 1;
    }

    .step-title {
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--dark-color);
    }

    .hand-animation {
        font-size: 2rem;
        animation: handBounce 1.2s infinite ease-in-out;
        color: var(--secondary-color);
        display: inline-block;
        margin: 10px 0;
        text-align: center;
        width: 100%;
    }

    .info-container {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: var(--shadow);
    }

    .info-title {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 20px;
        color: var(--primary-color);
        display: flex;
        align-items: center;
    }

    .info-title i {
        margin-right: 10px;
        color: var(--secondary-color);
    }

    .info-content {
        line-height: 1.8;
    }

    .info-content h3 {
        margin: 20px 0 10px;
        color: var(--primary-light);
    }

    .info-content ul, .info-content ol {
        padding-left: 20px;
        margin-bottom: 15px;
    }

    .info-content li {
        margin-bottom: 8px;
    }

    /* Botones flotantes agrupados */
    .floating-btn-container {
        position: fixed;
        bottom: 80px;
        right: 20px;
        z-index: 1001;
    }

    .main-floating-btn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        border: none;
        cursor: pointer;
        transition: var(--transition);
        position: relative;
        z-index: 2;
    }

    .main-floating-btn:hover {
        transform: translateY(-3px) scale(1.1);
        box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }

    .main-floating-btn i {
        font-size: 24px;
        transition: transform 0.3s ease;
    }

    .floating-btns {
        position: absolute;
        bottom: 70px;
        right: 0;
        display: flex;
        flex-direction: column;
        gap: 15px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(20px);
        transition: all 0.3s ease;
    }

    .floating-btn-container.active .floating-btns {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .floating-btn-container.active .main-floating-btn i {
        transform: rotate(45deg);
    }

    .floating-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        border: none;
        cursor: pointer;
        transition: var(--transition);
    }

    .floating-btn:hover {
        transform: translateY(-3px) scale(1.1);
        box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }

    .floating-btn i {
        font-size: 20px;
    }

    .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
        z-index: 1000;
        padding: 10px 0;
    }

    .nav-items {
        display: flex;
        justify-content: space-around;
        max-width: 1400px;
        margin: 0 auto;
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: var(--dark-color);
        text-decoration: none;
        font-size: 12px;
        transition: var(--transition);
        padding: 5px 10px;
        border-radius: 8px;
    }

    .nav-item i {
        font-size: 22px;
        margin-bottom: 5px;
        color: var(--primary-color);
    }

    .nav-item.active, .nav-item:hover {
        background: rgba(11, 66, 55, 0.1);
        color: var(--primary-color);
    }

    .nav-item.active i, .nav-item:hover i {
        color: var(--secondary-color);
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.7);
        z-index: 2000;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s;
    }

    .modal.show {
        display: flex;
        opacity: 1;
    }

    .modal-content {
        background: white;
        border-radius: 15px;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        transform: translateY(20px);
        transition: transform 0.3s;
        position: relative;
    }

    .modal.show .modal-content {
        transform: translateY(0);
    }

    .modal-header {
        padding: 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-header h3 {
        margin: 0;
        color: var(--primary-color);
    }

    .close-modal {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--dark-color);
    }

    .modal-body {
        padding: 20px;
    }

    .export-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 20px;
    }

    .export-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        transition: var(--transition);
    }

    .export-btn:hover {
        background: var(--primary-color);
        color: white;
    }

    .export-btn i {
        font-size: 30px;
        margin-bottom: 10px;
    }

    .welcome-modal .modal-content {
        max-width: 600px;
    }

    .welcome-content {
        text-align: center;
    }

    .welcome-icon {
        font-size: 48px;
        color: var(--primary-color);
        margin-bottom: 20px;
    }

    .dont-show-again {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 20px;
    }

    .dont-show-again input {
        margin-right: 10px;
    }

    .dark-mode {
        background-color: #121212;
        color: #e0e0e0;
    }

    .dark-mode .calculator-card,
    .dark-mode .guide-step,
    .dark-mode .chart-container,
    .dark-mode .info-container,
    .dark-mode .guide-container {
        background-color: #1e1e1e;
        color: #e0e0e0;
    }

    .dark-mode .input-wrapper input {
        background-color: #2d2d2d;
        border-color: #444;
        color: #e0e0e0;
    }

    .dark-mode .results-container {
        background-color: #252525;
    }

    .dark-mode .result-item {
        border-bottom-color: #444;
    }

    .dark-mode .bottom-nav {
        background-color: #1e1e1e;
        box-shadow: 0 -5px 20px rgba(0,0,0,0.3);
    }

    .dark-mode .nav-item {
        color: #e0e0e0;
    }

    .dark-mode .modal-content {
        background-color: #2d2d2d;
        color: #e0e0e0;
    }

    .dark-mode .modal-header {
        border-bottom-color: #444;
    }

    .dark-mode .export-btn {
        background-color: #252525;
        color: #e0e0e0;
    }

    .dark-mode .info-title,
    .dark-mode .guide-title {
        color: var(--secondary-color);
    }

    .dark-mode .step-title {
        color: #e0e0e0;
    }

    .dark-mode .welcome-icon {
        color: var(--secondary-color);
    }

    /* Sección de Historial independiente */
    .history-tab {
        margin-top: 30px;
    }

    .history-container {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: var(--shadow);
        margin-bottom: 30px;
    }

    .history-title {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 20px;
        color: var(--primary-color);
        display: flex;
        align-items: center;
    }

    .history-title i {
        margin-right: 10px;
        color: var(--secondary-color);
    }

    .history-list {
        margin-top: 20px;
    }

    .history-item {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: var(--transition);
    }

    .history-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .history-details {
        flex: 1;
    }

    .history-grade {
        font-size: 24px;
        font-weight: 700;
        margin-right: 15px;
        min-width: 60px;
        text-align: center;
    }

    .history-actions {
        display: flex;
        gap: 10px;
    }

    .history-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
        padding: 5px;
        color: var(--primary-color);
        transition: var(--transition);
    }

    .history-btn:hover {
        color: var(--secondary-color);
        transform: scale(1.1);
    }

    .history-date {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
    }

    .clear-history {
        margin-top: 20px;
        text-align: right;
    }

    .clear-history-btn {
        background: var(--accent-color);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        transition: var(--transition);
    }

    .clear-history-btn:hover {
        background: #c0392b;
    }

    .dark-mode .history-container,
    .dark-mode .history-item {
        background-color: #252525;
    }

    .dark-mode .history-item {
        background-color: #2d2d2d;
    }

    .dark-mode .history-date {
        color: #aaa;
    }

    .dark-mode .history-btn {
        color: var(--secondary-color);
    }

    /* Panel de personalización */
    .customization-panel {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: var(--shadow);
        margin-top: 30px;
    }

    .customization-title {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 20px;
        color: var(--primary-color);
        display: flex;
        align-items: center;
    }

    .customization-title i {
        margin-right: 10px;
        color: var(--secondary-color);
    }

    .color-options {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 15px;
    }

    .color-option {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid transparent;
        transition: var(--transition);
    }

    .color-option.selected {
        border-color: var(--dark-color);
        transform: scale(1.1);
    }

    /* Sección de Ajustes */
    .settings-panel {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: var(--shadow);
        margin-top: 30px;
    }

    .settings-title {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 20px;
        color: var(--primary-color);
        display: flex;
        align-items: center;
    }

    .settings-title i {
        margin-right: 10px;
        color: var(--secondary-color);
    }

    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #eee;
    }

    .setting-item:last-child {
        border-bottom: none;
    }

    .setting-label {
        font-weight: 500;
    }

    .setting-description {
        font-size: 13px;
        color: #666;
        margin-top: 5px;
    }

    .creator-credit {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #eee;
        color: #666;
        font-size: 13px;
    }

    .dark-mode .customization-panel,
    .dark-mode .settings-panel {
        background-color: #1e1e1e;
    }

    .dark-mode .setting-item {
        border-bottom-color: #444;
    }

    .dark-mode .setting-description,
    .dark-mode .creator-credit {
        color: #aaa;
    }

    /* Mejoras para impresión */
    @media print {
        body * {
            visibility: hidden;
        }
        
        .calculator-card, .calculator-card *,
        .history-container, .history-container * {
            visibility: visible;
        }
        
        .calculator-card, .history-container {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            box-shadow: none;
            background: white !important;
            color: black !important;
            margin: 0;
            padding: 0;
        }
        
        .bottom-nav, .floating-btns, .top-bar {
            display: none !important;
        }
        
        @page {
            size: auto;
            margin: 5mm;
        }
        
        .card-body {
            padding: 10px !important;
        }
        
        .final-grade-container {
            margin-top: 15px !important;
            padding: 15px !important;
        }
        
        .final-grade-value {
            font-size: 36px !important;
        }
        
        #gradeChart {
            max-width: 100% !important;
            height: auto !important;
        }
        
        .history-item {
            page-break-inside: avoid;
        }
        
        .final-grade-container, .chart-container {
            page-break-inside: avoid;
        }
    }

    @media (max-width: 768px) {
        .main-content {
            overflow-x: hidden;
            width: 100%;
        }
        
        .content-tab {
            width: 100%;
            transition: transform 0.3s ease;
        }
        
        .container {
            flex-direction: column;
            text-align: center;
        }
        
        .theme-switch {
            margin-top: 15px;
        }
        
        .final-grade-value {
            font-size: 36px;
        }
        
        .nav-items {
            padding: 0 10px;
        }
        
        .nav-item {
            font-size: 10px;
            padding: 5px;
        }
        
        .nav-item i {
            font-size: 18px;
        }
        
        .floating-btn-container {
            bottom: 70px;
            right: 10px;
        }
        
        .main-floating-btn {
            width: 55px;
            height: 55px;
        }
        
        .floating-btn {
            width: 45px;
            height: 45px;
        }
        
        .hand-animation {
            font-size: 1.5rem;
        }
        
        .welcome-modal .modal-content {
            width: 95%;
        }

        .calculator-grid {
            grid-template-columns: 1fr;
            gap: 25px;
            padding: 20px;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .results-container {
            margin-top: 20px;
        }
        
        .history-item {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .history-actions {
            margin-top: 10px;
            align-self: flex-end;
        }
        
        @media print {
            .calculator-card, .history-container {
                position: static;
                width: auto;
                margin: 0;
                padding: 10px;
            }
            
            .final-grade-value {
                font-size: 28px !important;
            }
            
            .result-value {
                font-size: 16px !important;
            }
            
            .chart-container {
                padding: 10px !important;
            }
        }
    }

    @keyframes rotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    @keyframes handBounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(10px); }
    }

    .animate-pulse {
        animation: pulse 2s infinite;
    }
    /* Contenedor principal de ajustes */
#ajustes-tab {
    max-width: 900px;
    margin: 0 auto;
    padding: 30px;
    background-color: var(--background-color, #ffffff);
    border-radius: 16px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    font-family: 'Segoe UI', sans-serif;
    color: var(--text-color, #333);
}

/* Título principal */
#ajustes-tab .settings-title {
    font-size: 28px;
    font-weight: 600;
    margin-bottom: 30px;
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--primary-color, #0b4237);
}

/* Secciones internas */
#ajustes-tab .settings-section {
    margin-bottom: 40px;
    border-top: 1px solid #e0e0e0;
    padding-top: 30px;
}

/* Título de sección */
#ajustes-tab .settings-section-title {
    font-size: 20px;
    font-weight: 500;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--primary-color, #0b4237);
}

/* Opciones */
#ajustes-tab .settings-option {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 15px 20px;
    background-color: var(--card-bg, #f9f9f9);
    border-radius: 10px;
    transition: background 0.3s ease;
}

#ajustes-tab .settings-option:hover {
    background-color: var(--card-hover-bg, #f0f0f0);
}

#ajustes-tab .settings-option-label h4 {
    margin: 0 0 5px;
    font-size: 16px;
    font-weight: 500;
}

#ajustes-tab .settings-option-label p {
    margin: 0;
    font-size: 14px;
    color: #666;
}

#ajustes-tab .toggle-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 30px;
    transition: all 0.3s ease-in-out;
}

#ajustes-tab .toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

#ajustes-tab .toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #cfd8dc;
    border-radius: 30px;
    transition: 0.4s;
    box-shadow: inset 0 0 3px rgba(0, 0, 0, 0.2);
}

#ajustes-tab .toggle-slider:before {
    content: "";
    position: absolute;
    height: 22px;
    width: 22px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    border-radius: 50%;
    transition: 0.4s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

#ajustes-tab .toggle-switch input:checked + .toggle-slider {
    background-color: var(--accent-color, #0b4237);
}

#ajustes-tab .toggle-switch input:checked + .toggle-slider:before {
    transform: translateX(30px);
}

#ajustes-tab .toggle-switch input:focus + .toggle-slider {
    box-shadow: 0 0 1px var(--accent-color, #0b4237);
}

/* Colores */
#ajustes-tab .color-options {
    display: flex;
    gap: 12px;
    margin-top: 15px;
    flex-wrap: wrap;
}

#ajustes-tab .color-option {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border 0.3s ease;
}

#ajustes-tab .color-option:hover {
    border-color: #aaa;
}

#ajustes-tab .color-option.selected {
    border-color: var(--accent-color, #0b4237);
}

/* Botón reset */
#ajustes-tab #resetColors {
    transition: background 0.3s ease, transform 0.2s;
}

#ajustes-tab #resetColors:hover {
    background: var(--primary-color, #0b4237);
    transform: scale(1.05);
}

/* Información final */
#ajustes-tab .app-info {
    text-align: center;
    margin-top: 40px;
    font-size: 14px;
    color: #888;
}

#ajustes-tab .app-version {
    font-weight: bold;
    color: var(--primary-color, #0b4237);
}

/* Modo oscuro */
.dark-mode #ajustes-tab {
    background-color: #1e1e1e;
    color: #e0e0e0;
}

.dark-mode #ajustes-tab .settings-section {
    border-top-color: #444;
}

.dark-mode #ajustes-tab .settings-option {
    background-color: #252525;
}

.dark-mode #ajustes-tab .settings-option:hover {
    background-color: #2d2d2d;
}

.dark-mode #ajustes-tab .settings-option-label p {
    color: #aaa;
}

.dark-mode #ajustes-tab .app-info {
    color: #aaa;
}
    </style>
</head>
<body><div class="top-bar">
    <div class="container">
        <a href="#" class="logo">
            <img src="https://raw.githubusercontent.com/AndresAlvarezmonvsyo/Calcular-notas-unad-by-a.a./refs/heads/main/ChatGPT%20Image%2018%20may%202025%2C%2007_46_50%20p.m..png" alt="Logo UNAD">
            <div class="logo-text">
                <span>Calculadora de Calificaciones</span>
                <span>Universidad Nacional Abierta y a Distancia</span>
                <span class="student-note">Desarrollado por un estudiante de Ingeniería en Sistemas como complemento a la calculadora UNAD</span>
            </div>
        </a>
        <div class="theme-switch">
            <span>Modo oscuro</span>
            <label class="switch">
                <input type="checkbox" id="themeToggle">
                <span class="slider"></span>
            </label>
        </div>
    </div>
</div>

<div class="main-content">
    <div class="container">
        <!-- Sección de calculadora -->
        <div id="calculadora-tab" class="content-tab active">
            <div class="calculator-card">
                <div class="card-header">
                    <h2><i class="fas fa-calculator"></i> Calculadora de Notas</h2>
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="card-body">
                    <div class="calculator-grid">
                        <div>
                            <div class="input-group">
                                <label for="p75">Puntos obtenidos (75%)</label>
                                <div class="input-wrapper">
                                    <input type="number" id="p75" value="0" min="0" max="375" step="1" class="puntos-input">
                                    <span class="max-label">Max 375</span>
                                </div>
                                <div class="error-message" id="error75">¡El valor máximo es 375 puntos!</div>
                                <div class="hand-animation">
                                    <i class="fas fa-hand-point-down"></i>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label for="p25">Puntos obtenidos (25%)</label>
                                <div class="input-wrapper">
                                    <input type="number" id="p25" value="0" min="0" max="125" step="1" class="puntos-input">
                                    <span class="max-label">Max 125</span>
                                </div>
                                <div class="error-message" id="error25">¡El valor máximo es 125 puntos!</div>
                                <div class="hand-animation" style="animation-delay: 0.5s;">
                                    <i class="fas fa-hand-point-down"></i>
                                </div>
                            </div>
                            
                            <div class="progress-container">
                                <div class="progress-info">
                                    <span>Progreso total</span>
                                    <span id="progressPercentage">0%</span>
                                </div>
                                <div class="progress-bar-bg">
                                    <div class="progress-bar-fill" id="progressBar"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="results-container">
                            <div class="result-item">
                                <span class="result-label">Nota 75%:</span>
                                <span class="result-value" id="n75">0.0</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Nota 25%:</span>
                                <span class="result-value" id="n25">0.0</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Total puntos:</span>
                                <span class="result-value" id="n100">0</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Nota final:</span>
                                <span class="result-value" id="tot">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="final-grade-container">
                        <h3 class="final-grade-title">TU NOTA FINAL ES</h3>
                        <div class="final-grade-value" id="finalGrade">0.0</div>
                        <p class="final-grade-message" id="gradeMessage">Ingresa tus puntos para calcular tu nota final</p>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-title">
                            <i class="fas fa-chart-pie"></i> Distribución de tu calificación
                        </div>
                        <canvas id="gradeChart"></canvas>
                    </div>
                    
                    <div style="display: flex; justify-content: center; gap: 15px; margin-top: 30px;">
                        <button id="saveToHistory" style="padding: 12px 25px; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
                            <i class="fas fa-save"></i> Guardar en historial
                        </button>
                        <button id="printBtn" style="padding: 12px 25px; background: var(--secondary-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
                            <i class="fas fa-print"></i> Imprimir resultados
                        </button>
                        <button id="exportBtn" style="padding: 12px 25px; background: var(--primary-light); color: white; border: none; border-radius: 8px; cursor: pointer;">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sección de historial -->
        <div id="historial-tab" class="content-tab history-tab">
            <div class="history-container">
                <h2 class="history-title">
                    <i class="fas fa-history"></i> Historial de Cálculos
                </h2>
                <p>Aquí puedes ver, editar y exportar tus cálculos anteriores.</p>
                
                <div class="history-list" id="historyList">
                    <!-- Los elementos del historial se agregarán aquí dinámicamente -->
                </div>
                
                <div class="clear-history">
                    <button class="clear-history-btn" id="clearHistoryBtn">
                        <i class="fas fa-trash"></i> Limpiar historial
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Sección de información -->
        <div id="informacion-tab" class="content-tab">
            <div class="info-container">
                <h2 class="info-title">
                    <i class="fas fa-info-circle"></i> Información Importante
                </h2>
                <div class="info-content">
                    <h3>Acerca de esta plataforma</h3>
                    <p>Esta calculadora fue desarrollada por un estudiante de Ingeniería en Sistemas como un complemento a la calculadora oficial de la UNAD, con el objetivo de brindar una experiencia más completa y accesible para los estudiantes.</p>
                    
                    <p>No pretende competir con los sistemas oficiales de la universidad, sino ser un avance hacia el futuro de herramientas educativas más intuitivas y funcionales.</p>
                    
                    <h3>Instrucciones de uso</h3>
                    <p>Esta calculadora te permite determinar tu nota final en un curso de la UNAD basado en el sistema de evaluación que divide la calificación en dos componentes:</p>
                    
                    <ul>
                        <li><strong>75% del curso:</strong> Corresponde a las actividades desarrolladas durante el periodo académico (trabajos, quices, foros, etc.)</li>
                        <li><strong>25% del curso:</strong> Corresponde al examen final o actividad de cierre del curso</li>
                    </ul>
                    
                    <h3>¿Cómo calcular tu nota?</h3>
                    <ol>
                        <li>Ingresa los puntos obtenidos en el componente del 75% (máximo 375 puntos)</li>
                        <li>Ingresa los puntos obtenidos en el componente del 25% (máximo 125 puntos)</li>
                        <li>La calculadora mostrará automáticamente tu nota final</li>
                        <li>Puedes guardar tus resultados en el historial para consultarlos después</li>
                    </ol>
                    
                    <h3>Escala de calificación UNAD</h3>
                    <p>La Universidad Nacional Abierta y a Distancia utiliza la siguiente escala de calificación:</p>
                    
                    <ul>
                        <li>4.6 - 5.0: Excelente</li>
                        <li>4.0 - 4.5: Bueno</li>
                        <li>3.5 - 3.9: Aceptable</li>
                        <li>3.0 - 3.4: Mínimo aprobatorio</li>
                        <li>0.0 - 2.9: No aprobado</li>
                    </ul>
                    
                    <h3>Consideraciones importantes</h3>
                    <p>Recuerda que para aprobar un curso en la UNAD debes:</p>
                    
                    <ul>
                        <li>Obtener una nota final igual o superior a 3.0</li>
                        <li>Participar en al menos el 80% de las actividades propuestas</li>
                        <li>Entregar todos los trabajos obligatorios del curso</li>
                    </ul>
                    
                    <p>Esta calculadora es una herramienta de referencia. Las calificaciones oficiales son las publicadas por la universidad en su sistema académico.</p>
                </div>
            </div>
        </div>
        
        <!-- Sección de guía -->
        <div id="guia-tab" class="content-tab">
            <div class="guide-container">
                <h2 class="guide-title">
                    <i class="fas fa-hands-helping"></i> Guía Paso a Paso
                </h2>
                
                <div class="guide-steps">
                    <div class="guide-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3 class="step-title">Ingresa tus puntos del 75%</h3>
                            <p>Escribe en el primer campo los puntos que has obtenido en actividades que valen el 75% de tu nota.</p>
                            <div class="hand-animation">
                                <i class="fas fa-hand-point-right"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="guide-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3 class="step-title">Ingresa tus puntos del 25%</h3>
                            <p>Escribe en el segundo campo los puntos obtenidos en actividades que valen el 25% restante.</p>
                            <div class="hand-animation" style="animation-delay: 0.5s;">
                                <i class="fas fa-hand-point-right"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="guide-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3 class="step-title">Observa tus resultados</h3>
                            <p>La calculadora mostrará automáticamente tus notas parciales y la nota final del curso.</p>
                            <div class="hand-animation" style="animation-delay: 1s;">
                                <i class="fas fa-hand-point-up"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="guide-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3 class="step-title">Guarda y exporta</h3>
                            <p>Guarda tus cálculos en el historial y exporta los resultados como imagen o PDF cuando lo necesites.</p>
                            <div class="hand-animation" style="animation-delay: 1.5s;">
                                <i class="fas fa-hand-point-down"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Video tutorial -->
            <div class="info-container" style="margin-top: 30px;">
                <h2 class="info-title">
                    <i class="fas fa-video"></i> Video Tutorial
                </h2>
                <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; margin-top: 20px; border-radius: 10px;">
                    <iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;" src="https://youtube.com/shorts/ysuOzb4mIns?si=LY-l0OT6KXYP7ioY" allowfullscreen></iframe>
                </div>
                <p style="text-align: center; margin-top: 15px;">Aprende a usar todas las funciones de la calculadora con este video tutorial.</p>
            </div>
        </div>
        
        <!-- Sección de ajustes -->
        <div id="ajustes-tab" class="content-tab">
            <div class="settings-container">
                <h2 class="settings-title">
                    <i class="fas fa-cog"></i> Ajustes de la Aplicación
                </h2>

                <!-- Personalización -->
                <div class="settings-section">
                    <h3 class="settings-section-title">
                        <i class="fas fa-palette"></i> Personalización
                    </h3>
                    <p>Cambia los colores principales de la aplicación:</p>

                    <div class="color-options">
                        <div class="color-option selected" style="background: #0b4237;" data-color="#0b4237"></div>
                        <div class="color-option" style="background: #2c3e50;" data-color="#2c3e50"></div>
                        <div class="color-option" style="background: #8e44ad;" data-color="#8e44ad"></div>
                        <div class="color-option" style="background: #16a085;" data-color="#16a085"></div>
                        <div class="color-option" style="background: #2980b9;" data-color="#2980b9"></div>
                        <div class="color-option" style="background: #c0392b;" data-color="#c0392b"></div>
                    </div>

                    <div style="margin-top: 20px;">
                        <button id="resetColors" style="padding: 8px 15px; background: var(--accent-color); color: white; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-undo"></i> Restablecer colores
                        </button>
                    </div>
                </div>

                <!-- Configuración de Gráficos -->
                <div class="settings-section">
                    <h3 class="settings-section-title">
                        <i class="fas fa-chart-pie"></i> Configuración de Gráficos
                    </h3>

                    <div class="settings-option">
                        <div class="settings-option-label">
                            <h4>Mostrar gráficos</h4>
                            <p>Activa o desactiva la visualización de gráficos en la calculadora</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="showChartsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Configuración de Historial -->
                <div class="settings-section">
                    <h3 class="settings-section-title">
                        <i class="fas fa-save"></i> Configuración de Historial
                    </h3>

                    <div class="settings-option">
                        <div class="settings-option-label">
                            <h4>Guardado automático</h4>
                            <p>Guarda automáticamente los cálculos en el historial</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoSaveToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Tema y Animaciones -->
                <div class="settings-section">
                    <h3 class="settings-section-title">
                        <i class="fas fa-adjust"></i> Preferencias Visuales
                    </h3>

                    <div class="settings-option">
                        <div class="settings-option-label">
                            <h4>Modo oscuro automático</h4>
                            <p>Ajusta el tema según las preferencias de tu sistema</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoDarkModeToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="settings-option">
                        <div class="settings-option-label">
                            <h4>Animaciones</h4>
                            <p>Habilita o deshabilita las animaciones de la aplicación</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="animationsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Información de la aplicación -->
                <div class="app-info">
                    <div class="app-version">Versión 1.5.7 - Mayo 2025</div>
                    <div class="app-creator">Powered By Julian Andres Alvarez</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Botones flotantes -->
<div class="floating-btn-container">
    <button class="main-floating-btn" id="mainFloatingBtn">
        <i class="fas fa-plus"></i>
    </button>
    <div class="floating-btns">
        <button class="floating-btn" id="floatingExportBtn" title="Exportar resultados">
            <i class="fas fa-file-export"></i>
        </button>
        <button class="floating-btn" id="floatingPrintBtn" title="Imprimir resultados">
            <i class="fas fa-print"></i>
        </button>
        <button class="floating-btn" id="floatingThemeBtn" title="Cambiar tema">
            <i class="fas fa-moon"></i>
        </button>
    </div>
</div>

<!-- Barra de navegación inferior -->
<div class="bottom-nav">
    <div class="nav-items">
        <a href="#" class="nav-item active" data-tab="calculadora-tab">
            <i class="fas fa-calculator"></i>
            <span>Calculadora</span>
        </a>
        <a href="#" class="nav-item" data-tab="historial-tab">
            <i class="fas fa-history"></i>
            <span>Historial</span>
        </a>
        <a href="#" class="nav-item" data-tab="informacion-tab">
            <i class="fas fa-info-circle"></i>
            <span>Información</span>
        </a>
        <a href="#" class="nav-item" data-tab="guia-tab">
            <i class="fas fa-question-circle"></i>
            <span>Guía</span>
        </a>
        <a href="#" class="nav-item" data-tab="ajustes-tab">
            <i class="fas fa-cog"></i>
            <span>Ajustes</span>
        </a>
    </div>
</div>

<!-- Modal de exportación -->
<div class="modal" id="exportModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Exportar resultados</h3>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <p>Selecciona el formato en el que deseas guardar tus resultados:</p>
            
            <div class="export-options">
                <button class="export-btn" id="exportPng">
                    <i class="fas fa-file-image"></i>
                    <span>Imagen (PNG)</span>
                </button>
                
                <button class="export-btn" id="exportPdf">
                    <i class="fas fa-file-pdf"></i>
                    <span>Documento (PDF)</span>
                </button>
                
                <button class="export-btn" id="exportJpeg">
                    <i class="fas fa-file-image"></i>
                    <span>Imagen (JPEG)</span>
                </button>
                
                <button class="export-btn" id="exportCsv">
                    <i class="fas fa-file-csv"></i>
                    <span>Datos (CSV)</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de bienvenida -->
<div class="modal welcome-modal" id="welcomeModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>¡Bienvenido a la Calculadora UNAD Premium!</h3>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <div class="welcome-content">
                <div class="welcome-icon">
                    <i class="fas fa-calculator"></i>
                </div>
                <h4>Calcula tu nota final fácilmente</h4>
                <p>Esta herramienta premium fue desarrollada por un estudiante de Ingeniería en Sistemas como complemento a la calculadora oficial de la UNAD, con el objetivo de brindar una experiencia más completa.</p>
                
                <div style="text-align: left; margin: 20px 0;">
                    <h5 style="color: var(--primary-color); margin-bottom: 10px;">Nuevas características:</h5>
                    <ul>
                        <li>Historial independiente con más funciones</li>
                        <li>Personalización de colores</li>
                        <li>Mejor soporte para impresión en móviles</li>
                        <li>Exportación a múltiples formatos</li>
                        <li>Interfaz más intuitiva</li>
                    </ul>
                </div>
                
                <div class="dont-show-again">
                    <input type="checkbox" id="dontShowAgain">
                    <label for="dontShowAgain">No mostrar este mensaje nuevamente</label>
                </div>
                
                <button onclick="closeWelcomeModal()" style="margin-top: 20px; padding: 10px 20px; background: var(--primary-color); color: white; border: none; border-radius: 8px; cursor: pointer;">
                    Comenzar a usar
                </button>
            </div>
        </div>
    </div>
</div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
     $(document).ready(function() {
    // Variables globales
    let gradeChart = null;
    let darkMode = false;
    let touchStartX = 0;
    let touchEndY = 0;
    let currentCalculationId = null;
    
    // Mostrar modal de bienvenida si no está marcado para no mostrar
    if (!localStorage.getItem('dontShowWelcome')) {
        setTimeout(() => {
            $('#welcomeModal').addClass('show');
        }, 500);
    }
    
    // Función para cerrar el modal de bienvenida
    window.closeWelcomeModal = function() {
        if ($('#dontShowAgain').is(':checked')) {
            localStorage.setItem('dontShowWelcome', 'true');
        }
        $('#welcomeModal').removeClass('show');
    };
    
    // Configurar tema inicial
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        enableDarkMode();
    }
    
    // Event listeners
    $('#themeToggle').change(function() {
        $(this).is(':checked') ? enableDarkMode() : disableDarkMode();
    });
    
    // Toggle para botones flotantes
    $('#mainFloatingBtn').click(function() {
        $('.floating-btn-container').toggleClass('active');
    });
    
    // Cerrar botones flotantes al hacer clic fuera
    $(document).click(function(e) {
        if (!$(e.target).closest('.floating-btn-container').length) {
            $('.floating-btn-container').removeClass('active');
        }
    });
    
    $('#floatingThemeBtn').click(() => $('#themeToggle').click());
    $('#floatingExportBtn').click(() => $('#exportModal').addClass('show'));
    $('#floatingPrintBtn').click(printResults);
    $('.close-modal').click(function() { $(this).closest('.modal').removeClass('show'); });
    
    // Botones de exportación
    $('#exportPng').click(() => exportResults('png'));
    $('#exportPdf').click(() => exportResults('pdf'));
    $('#exportJpeg').click(() => exportResults('jpeg'));
    $('#exportCsv').click(exportToCsv);
    
    // Navegación por pestañas
    $('[data-tab]').click(function(e) {
        e.preventDefault();
        const tabId = $(this).data('tab');
        
        $('.nav-item').removeClass('active');
        $(this).addClass('active');
        $('.content-tab').removeClass('active');
        $(`#${tabId}`).addClass('active');
        
        if (tabId === 'calculadora-tab' && gradeChart) {
            gradeChart.update();
        }
    });
    
    // Inputs y cálculos
    $('.puntos-input').on('input', calculateGrades);
    $('#saveToHistory').click(saveToHistory);
    $('#printBtn').click(printResults);
    $('#exportBtn').click(() => $('#exportModal').addClass('show'));
    $('#clearHistoryBtn').click(clearHistory);
    
    // Personalización de colores
    $('.color-option').click(function() {
        const newColor = $(this).data('color');
        changePrimaryColor(newColor);
        $('.color-option').removeClass('selected');
        $(this).addClass('selected');
    });
    
    $('#resetColors').click(function() {
        changePrimaryColor('#0b4237');
        $('.color-option').removeClass('selected');
        $('.color-option:first').addClass('selected');
    });
    
    // Configuración de ajustes
    $('#autoSaveToggle').change(function() {
        localStorage.setItem('autoSave', $(this).is(':checked'));
    });
    
    $('#showChartsToggle').change(function() {
        localStorage.setItem('showCharts', $(this).is(':checked'));
        if (gradeChart) {
            $('.chart-container').toggle($(this).is(':checked'));
        }
    });
    
    $('#autoDarkModeToggle').change(function() {
        localStorage.setItem('autoDarkMode', $(this).is(':checked'));
        if ($(this).is(':checked') && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            enableDarkMode();
        }
    });
    
    $('#animationsToggle').change(function() {
        localStorage.setItem('animations', $(this).is(':checked'));
        $('body').toggleClass('no-animations', !$(this).is(':checked'));
    });
    
    // Cargar configuraciones guardadas
    if (localStorage.getItem('autoSave') !== null) {
        $('#autoSaveToggle').prop('checked', localStorage.getItem('autoSave') === 'true');
    }
    
    if (localStorage.getItem('showCharts') !== null) {
        $('#showChartsToggle').prop('checked', localStorage.getItem('showCharts') === 'true');
    }
    
    if (localStorage.getItem('autoDarkMode') !== null) {
        $('#autoDarkModeToggle').prop('checked', localStorage.getItem('autoDarkMode') === 'true');
    }
    
    if (localStorage.getItem('animations') !== null) {
        $('#animationsToggle').prop('checked', localStorage.getItem('animations') === 'true');
        $('body').toggleClass('no-animations', localStorage.getItem('animations') === 'false');
    }
    
    // Nueva función: Calcular nota necesaria
    $('#calculateRequired').click(calculateRequiredGrade);
    
    // Botón para copiar resultados
    $('#copyResults').click(copyResultsToClipboard);
    
    // Cargar datos iniciales
    loadHistory();
    calculateGrades();
    
    // Funciones principales
    function changePrimaryColor(newColor) {
        const lighterColor = lightenColor(newColor, 20);
        
        $('body').css({
            '--primary-color': newColor,
            '--primary-light': lighterColor
        });
        
        localStorage.setItem('primaryColor', newColor);
        localStorage.setItem('primaryLight', lighterColor);
        
        if (gradeChart) gradeChart.update();
    }
    
    function lightenColor(color, percent) {
        const num = parseInt(color.replace("#", ""), 16);
        const amt = Math.round(2.55 * percent);
        const R = (num >> 16) + amt;
        const G = (num >> 8 & 0x00FF) + amt;
        const B = (num & 0x0000FF) + amt;
        
        return "#" + (
            0x1000000 +
            (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
            (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +
            (B < 255 ? (B < 1 ? 0 : B) : 255)
        ).toString(16).slice(1);
    }
    
    function calculateGrades() {
        const p75 = parseFloat($('#p75').val()) || 0;
        const p25 = parseFloat($('#p25').val()) || 0;
        
        const error75 = p75 > 375;
        const error25 = p25 > 125;
        
        $('#error75').toggle(error75);
        $('#error25').toggle(error25);
        
        const n75 = error75 ? 0 : (p75 / 75).toFixed(1);
        const n25 = error25 ? 0 : (p25 / 25).toFixed(1);
        const totalPoints = (error75 || error25) ? 0 : (p75 + p25);
        const finalGrade = (error75 || error25) ? 0 : (p75 / 75 * 0.75 + p25 / 25 * 0.25).toFixed(1);
        
        $('#n75').text(n75);
        $('#n25').text(n25);
        $('#n100').text(totalPoints);
        $('#tot').text(finalGrade);
        
        updateFinalGrade(finalGrade, error75 || error25);
        updateProgress(p75, p25, error75, error25);
        updateChart(n75, n25, finalGrade);
        
        // Generar ID único para este cálculo
        currentCalculationId = 'calc-' + Date.now();
    }
    
    function calculateRequiredGrade() {
        const currentP75 = parseFloat($('#p75').val()) || 0;
        const desiredGrade = parseFloat($('#desiredGrade').val()) || 0;
        
        if (currentP75 === 0) {
            alert('Por favor ingresa primero tus puntos del 75%');
            return;
        }
        
        if (desiredGrade < 1 || desiredGrade > 5) {
            alert('La nota deseada debe estar entre 1.0 y 5.0');
            return;
        }
        
        const currentGrade75 = (currentP75 / 75) * 0.75;
        const requiredGrade25 = (desiredGrade - currentGrade75) / 0.25;
        const requiredPoints25 = requiredGrade25 * 25;
        
        if (requiredPoints25 > 125) {
            $('#requiredGradeResult').html(`
                <div class="alert alert-danger">
                    <strong>No es posible</strong> alcanzar ${desiredGrade} con los puntos actuales del 75%.
                    La nota máxima posible es ${(currentGrade75 + 0.25).toFixed(1)}.
                </div>
            `);
        } else if (requiredPoints25 < 0) {
            $('#requiredGradeResult').html(`
                <div class="alert alert-success">
                    <strong>Ya has superado</strong> la nota deseada (${desiredGrade}).
                    Puedes obtener 0 puntos en el 25% y aún así tendrías ${(currentGrade75).toFixed(1)}.
                </div>
            `);
        } else {
            $('#requiredGradeResult').html(`
                <div class="alert alert-info">
                    <strong>Necesitas:</strong><br>
                    ${requiredPoints25.toFixed(1)} puntos en el 25% (Nota ${requiredGrade25.toFixed(1)})<br>
                    <small>Para alcanzar ${desiredGrade} como nota final</small>
                </div>
            `);
        }
        
        $('#requiredGradeModal').addClass('show');
    }
    
    function copyResultsToClipboard() {
        const p75 = parseFloat($('#p75').val()) || 0;
        const p25 = parseFloat($('#p25').val()) || 0;
        const finalGrade = $('#finalGrade').text();
        
        if (p75 === 0 && p25 === 0) {
            alert('No hay resultados para copiar');
            return;
        }
        
        const textToCopy = `Resultados UNAD:
Puntos 75%: ${p75} (Nota ${(p75/75).toFixed(1)})
Puntos 25%: ${p25} (Nota ${(p25/25).toFixed(1)})
Nota Final: ${finalGrade}
Calculado el ${new Date().toLocaleDateString()}`;
        
        navigator.clipboard.writeText(textToCopy).then(() => {
            showFeedbackMessage('Resultados copiados al portapapeles', 'success');
        }).catch(err => {
            alert('Error al copiar: ' + err);
        });
    }
    
    function updateFinalGrade(grade, isError) {
        if (isError) {
            $('#finalGrade').text('0.0').removeClass('success warning danger animate-pulse');
            $('#gradeMessage').text('Corrige los valores ingresados').removeClass('success warning danger');
            return;
        }
        
        $('#finalGrade').text(grade);
        
        if (grade >= 4.5) {
            $('#finalGrade').addClass('success').removeClass('warning danger');
            $('#gradeMessage').text('¡Excelente trabajo! Sigue así.').addClass('success').removeClass('warning danger');
        } else if (grade >= 3.5) {
            $('#finalGrade').addClass('warning').removeClass('success danger');
            $('#gradeMessage').text('Buen resultado. Puedes mejorar.').addClass('warning').removeClass('success danger');
        } else if (grade >= 3.0) {
            $('#finalGrade').addClass('danger').removeClass('success warning');
            $('#gradeMessage').text('Aprobado, pero considera reforzar tus conocimientos.').addClass('danger').removeClass('success warning');
        } else {
            $('#finalGrade').addClass('danger animate-pulse').removeClass('success warning');
            $('#gradeMessage').text('Necesitas mejorar tu desempeño.').addClass('danger').removeClass('success warning');
        }
    }
    
    function updateProgress(p75, p25, error75, error25) {
        const maxPossible = 500;
        const currentTotal = (error75 ? 0 : p75) + (error25 ? 0 : p25);
        const progressPercent = Math.min(100, (currentTotal / maxPossible) * 100);
        
        $('#progressPercentage').text(Math.round(progressPercent) + '%');
        $('#progressBar').css('width', progressPercent + '%');
        
        if (progressPercent >= 90) {
            $('#progressBar').css('background', `linear-gradient(90deg, var(--primary-color), var(--success-color))`);
        } else if (progressPercent >= 70) {
            $('#progressBar').css('background', `linear-gradient(90deg, var(--primary-color), var(--secondary-color))`);
        } else {
            $('#progressBar').css('background', `linear-gradient(90deg, var(--primary-color), var(--accent-color))`);
        }
    }
    
    function updateChart(n75, n25, finalGrade) {
        const ctx = document.getElementById('gradeChart').getContext('2d');
        
        if (gradeChart) gradeChart.destroy();
        
        gradeChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['75% del curso', '25% del curso'],
                datasets: [{
                    data: [n75 * 0.75, n25 * 0.25],
                    backgroundColor: [
                        'rgba(11, 66, 55, 0.8)',
                        'rgba(245, 166, 35, 0.8)'
                    ],
                    borderColor: [
                        'rgba(11, 66, 55, 1)',
                        'rgba(245, 166, 35, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { font: { family: 'Poppins', size: 12 } }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.raw.toFixed(2)} (${(context.raw * 20).toFixed(1)}%)`;
                            }
                        }
                    },
                    title: {
                        display: true,
                        text: `Nota Final: ${finalGrade}`,
                        font: { family: 'Poppins', size: 16, weight: 'bold' }
                    }
                },
                cutout: '70%',
                animation: { animateScale: true, animateRotate: true }
            }
        });
    }
    
    function exportResults(format) {
        let element, fileName;
        
        if ($('#historial-tab').hasClass('active')) {
            element = $('.history-container')[0];
            fileName = `Historial_Notas_UNAD_${new Date().toISOString().slice(0,10)}`;
        } else {
            element = $('.calculator-card')[0];
            fileName = `Nota_UNAD_${new Date().toISOString().slice(0,10)}`;
        }
        
        const options = {
            scale: 4,
            useCORS: true,
            allowTaint: true,
            backgroundColor: darkMode ? '#1e1e1e' : '#ffffff',
            logging: false,
            letterRendering: true,
            quality: 1,
            dpi: 300,
            onclone: (clonedDoc) => {
                clonedDoc.body.style.background = darkMode ? '#1e1e1e' : '#ffffff';
                clonedDoc.body.style.color = darkMode ? '#ffffff' : '#333333';
            }
        };
        
        showProcessingMessage('Preparando exportación en alta calidad...');
        
        html2canvas(element, options).then(canvas => {
            removeProcessingMessage();
            
            if (format === 'pdf') {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: [canvas.width * 0.264583, canvas.height * 0.264583]
                });
                
                pdf.addImage(canvas, 'PNG', 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());
                pdf.save(`${fileName}.pdf`);
            } else {
                const link = document.createElement('a');
                link.download = `${fileName}.${format}`;
                link.href = canvas.toDataURL(`image/${format}`, 1.0);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            $('#exportModal').removeClass('show');
        }).catch(err => {
            removeProcessingMessage();
            alert('Error al exportar: ' + err.message);
        });
    }
    
    function printResults() {
        const p75 = parseFloat($('#p75').val()) || 0;
        const p25 = parseFloat($('#p25').val()) || 0;
        const finalGrade = $('#finalGrade').text();
        
        if (p75 === 0 && p25 === 0) {
            alert('No hay datos para imprimir. Ingresa tus puntos primero.');
            return;
        }
        
        // Crear contenido optimizado para impresión
        const printContent = $(`
            <div id="print-container" style="width: 100%; max-width: 800px; margin: 0 auto; padding: 20px; font-family: 'Poppins', sans-serif;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h1 style="color: var(--primary-color); margin-bottom: 5px;">Calculadora UNAD</h1>
                    <p style="color: #666; font-size: 16px;">Resultados de tu cálculo</p>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                    <div style="flex: 1; text-align: center; padding: 15px; background: #f9f9f9; border-radius: 10px; margin: 0 10px;">
                        <h3 style="margin-top: 0; color: var(--primary-color);">Puntos 75%</h3>
                        <div style="font-size: 32px; font-weight: bold; color: var(--primary-color);">${p75}</div>
                        <div style="font-size: 14px; color: #666;">${(p75/75).toFixed(1)} de nota</div>
                    </div>
                    
                    <div style="flex: 1; text-align: center; padding: 15px; background: #f9f9f9; border-radius: 10px; margin: 0 10px;">
                        <h3 style="margin-top: 0; color: var(--primary-color);">Puntos 25%</h3>
                        <div style="font-size: 32px; font-weight: bold; color: var(--primary-color);">${p25}</div>
                        <div style="font-size: 14px; color: #666;">${(p25/25).toFixed(1)} de nota</div>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 30px 0;">
                    <div id="print-chart-container" style="width: 300px; height: 300px; margin: 0 auto;"></div>
                </div>
                
                <div style="text-align: center; background: var(--primary-light); padding: 20px; border-radius: 10px; margin-top: 30px;">
                    <h2 style="margin-top: 0; color: white;">NOTA FINAL</h2>
                    <div style="font-size: 48px; font-weight: bold; color: white;">${finalGrade}</div>
                    <div style="font-size: 14px; color: rgba(255,255,255,0.8);">Calculado el ${new Date().toLocaleDateString()}</div>
                </div>
                
                <div style="text-align: center; margin-top: 30px; font-size: 12px; color: #999;">
                    Generado con la Calculadora UNAD
                </div>
            </div>
        `);
        
        // Agregar al body temporalmente
        $('body').append(printContent);
        
        // Crear el gráfico para impresión
        const printCanvas = $('<canvas id="printChart" width="300" height="300"></canvas>');
        $('#print-chart-container').append(printCanvas);
        
        const printCtx = printCanvas[0].getContext('2d');
        const printChart = new Chart(printCtx, {
            type: 'doughnut',
            data: gradeChart.data,
            options: {
                responsive: false,
                plugins: {
                    legend: { display: true, position: 'bottom' },
                    title: { 
                        display: true, 
                        text: `Nota Final: ${finalGrade}`,
                        font: { size: 16, weight: 'bold' }
                    }
                },
                cutout: '65%'
            }
        });
        
        // Esperar a que se renderice el gráfico
        setTimeout(() => {
            // Configurar ventana de impresión
            const printWindow = window.open('', '_blank');
            printWindow.document.open();
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Resultados UNAD - ${finalGrade}</title>
                        <style>
                            @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
                            body { 
                                font-family: 'Poppins', sans-serif; 
                                background: white; 
                                color: #333; 
                                margin: 0; 
                                padding: 0; 
                            }
                            @page { 
                                size: auto; 
                                margin: 10mm; 
                            }
                            @media print {
                                .no-print { display: none !important; }
                            }
                        </style>
                        <script src="https://cdn.jsdelivr.net/npm/chart.js"><\/script>
                    </head>
                    <body>
                        ${printContent.html()}
                        <script>
                            // Recrear el gráfico en la ventana de impresión
                            window.onload = function() {
                                const ctx = document.getElementById('printChart').getContext('2d');
                                new Chart(ctx, {
                                    type: 'doughnut',
                                    data: ${JSON.stringify(gradeChart.data)},
                                    options: {
                                        responsive: false,
                                        plugins: {
                                            legend: { position: 'bottom' },
                                            title: { 
                                                display: true, 
                                                text: 'Nota Final: ${finalGrade}',
                                                font: { size: 16, weight: 'bold' }
                                            }
                                        },
                                        cutout: '65%'
                                    }
                                });
                                
                                setTimeout(() => {
                                    window.print();
                                    setTimeout(() => window.close(), 1000);
                                }, 500);
                            };
                        <\/script>
                    </body>
                </html>
            `);
            printWindow.document.close();
            
            // Eliminar el contenido temporal
            printContent.remove();
        }, 500);
    }
    
    function exportToCsv() {
        const history = JSON.parse(localStorage.getItem('gradeHistory') || '[]');
        if (history.length === 0) {
            alert('No hay datos en el historial para exportar');
            return;
        }
        
        let csv = 'Fecha,Puntos 75%,Puntos 25%,Nota Final\n';
        history.forEach(item => {
            csv += `"${item.date}",${item.p75},${item.p25},${item.finalGrade}\n`;
        });
        
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        
        link.setAttribute('href', url);
        link.setAttribute('download', `Historial_Notas_UNAD_${new Date().toISOString().slice(0,10)}.csv`);
        link.style.visibility = 'hidden';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        $('#exportModal').removeClass('show');
    }
    
    function saveToHistory() {
        const p75 = parseFloat($('#p75').val()) || 0;
        const p25 = parseFloat($('#p25').val()) || 0;
        const finalGrade = $('#finalGrade').text();
        
        if (p75 === 0 && p25 === 0) {
            alert('No hay datos para guardar. Ingresa tus puntos primero.');
            return;
        }
        
        const historyItem = {
            id: currentCalculationId || 'calc-' + Date.now(),
            p75: p75,
            p25: p25,
            finalGrade: finalGrade,
            date: new Date().toLocaleString()
        };
        
        let history = JSON.parse(localStorage.getItem('gradeHistory') || '[]');
        history.unshift(historyItem);
        
        if (history.length > 50) history = history.slice(0, 50);
        localStorage.setItem('gradeHistory', JSON.stringify(history));
        loadHistory();
        
        showFeedbackMessage('¡Cálculo guardado en el historial!', 'success');
    }
    
    function loadHistory() {
        const history = JSON.parse(localStorage.getItem('gradeHistory') || '[]');
        const historyList = $('#historyList');
        historyList.empty();
        
        if (history.length === 0) {
            historyList.html('<p style="text-align: center; color: #666;">No hay cálculos guardados</p>');
            return;
        }
        
        history.forEach((item, index) => {
            const historyItem = $(`
                <div class="history-item" data-id="${item.id}">
                    <div class="history-details">
                        <div><strong>75%:</strong> ${item.p75} pts | <strong>25%:</strong> ${item.p25} pts</div>
                        <div class="history-date">${item.date}</div>
                    </div>
                    <div class="history-grade">${item.finalGrade}</div>
                    <div class="history-actions">
                        <button class="history-btn edit-history" data-index="${index}" title="Editar">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="history-btn export-history" data-index="${index}" title="Exportar">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="history-btn delete-history" data-index="${index}" title="Eliminar">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `);
            
            historyList.append(historyItem);
        });
        
        // Eventos del historial
        $('.edit-history').click(function() {
            const index = $(this).data('index');
            const history = JSON.parse(localStorage.getItem('gradeHistory') || '[]');
            const item = history[index];
            
            $('#p75').val(item.p75);
            $('#p25').val(item.p25);
            calculateGrades();
            
            $('.nav-item').removeClass('active');
            $('[data-tab="calculadora-tab"]').addClass('active');
            $('.content-tab').removeClass('active');
            $('#calculadora-tab').addClass('active');
            
            showFeedbackMessage('Cálculo cargado', 'info');
        });
        
        $('.export-history').click(function() {
            const index = $(this).data('index');
            const history = JSON.parse(localStorage.getItem('gradeHistory') || '[]');
            const item = history[index];
            
            const tempElement = $(`
                <div class="calculator-card" style="margin: 20px;">
                    <div class="card-header">
                        <h2><i class="fas fa-calculator"></i> Historial de Cálculo</h2>
                    </div>
                    <div class="card-body">
                        <div class="results-container">
                            <div class="result-item">
                                <span class="result-label">Puntos 75%:</span>
                                <span class="result-value">${item.p75}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Puntos 25%:</span>
                                <span class="result-value">${item.p25}</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Nota final:</span>
                                <span class="result-value">${item.finalGrade}</span>
                            </div>
                        </div>
                        <div class="final-grade-container">
                            <h3 class="final-grade-title">NOTA GUARDADA</h3>
                            <div class="final-grade-value">${item.finalGrade}</div>
                            <p class="final-grade-message">Guardado el ${item.date}</p>
                        </div>
                    </div>
                </div>
            `);
            
            $('body').append(tempElement);
            showProcessingMessage('Preparando exportación...');
            
            html2canvas(tempElement[0], {
                scale: 4,
                useCORS: true,
                allowTaint: true,
                backgroundColor: darkMode ? '#1e1e1e' : '#ffffff',
                quality: 1
            }).then(canvas => {
                removeProcessingMessage();
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgData = canvas.toDataURL('image/png', 1.0);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save(`Nota_UNAD_Historial_${index}.pdf`);
                tempElement.remove();
            }).catch(err => {
                removeProcessingMessage();
                alert('Error al exportar: ' + err.message);
                tempElement.remove();
            });
        });
        
        $('.delete-history').click(function() {
            if (confirm('¿Estás seguro de que quieres eliminar este cálculo del historial?')) {
                const index = $(this).data('index');
                let history = JSON.parse(localStorage.getItem('gradeHistory') || '[]');
                
                history.splice(index, 1);
                localStorage.setItem('gradeHistory', JSON.stringify(history));
                loadHistory();
                
                showFeedbackMessage('Elemento eliminado', 'accent');
            }
        });
    }
    
    function clearHistory() {
        if (confirm('¿Estás seguro de que quieres borrar todo el historial? Esta acción no se puede deshacer.')) {
            localStorage.removeItem('gradeHistory');
            loadHistory();
            showFeedbackMessage('Historial borrado', 'accent');
        }
    }
    
    function enableDarkMode() {
        $('body').addClass('dark-mode');
        darkMode = true;
        $('#themeToggle').prop('checked', true);
        $('#floatingThemeBtn').html('<i class="fas fa-sun"></i>');
        if (gradeChart) gradeChart.update();
    }
    
    function disableDarkMode() {
        $('body').removeClass('dark-mode');
        darkMode = false;
        $('#themeToggle').prop('checked', false);
        $('#floatingThemeBtn').html('<i class="fas fa-moon"></i>');
        if (gradeChart) gradeChart.update();
    }
    
    // Funciones auxiliares
    function showProcessingMessage(message) {
        const processingMessage = $(`
            <div class="processing-message">
                <div class="processing-content">
                    <div class="spinner"></div>
                    <p>${message}</p>
                </div>
            </div>
        `);
        $('body').append(processingMessage);
    }
    
    function removeProcessingMessage() {
        $('.processing-message').remove();
    }
    
    function showFeedbackMessage(message, type) {
        const feedback = $(`
            <div class="feedback-message ${type}">
                ${message}
            </div>
        `);
        $('body').append(feedback);
        
        setTimeout(() => {
            feedback.fadeOut(500, () => feedback.remove());
        }, 2000);
    }
    
    // Eventos de gestos táctiles (solo horizontales)
    document.addEventListener('touchstart', function(e) {
        touchStartX = e.changedTouches[0].screenX;
        touchEndY = e.changedTouches[0].screenY;
    }, { passive: true });
    
    document.addEventListener('touchmove', function(e) {
        const touch = e.changedTouches[0];
        if (Math.abs(touch.screenX - touchStartX) > Math.abs(touch.screenY - touchEndY)) {
            e.preventDefault();
        }
    }, { passive: false });
    
    document.addEventListener('touchend', function(e) {
        const touch = e.changedTouches[0];
        const deltaX = touch.screenX - touchStartX;
        const deltaY = touch.screenY - touchEndY;
        
        if (Math.abs(deltaX) > 50 && Math.abs(deltaY) < 30) {
            if (deltaX > 0) {
                navigateTabs(-1); // Swipe derecha
            } else {
                navigateTabs(1); // Swipe izquierda
            }
        }
    }, { passive: true });
    
    function navigateTabs(direction) {
        const tabs = ['calculadora-tab', 'historial-tab', 'informacion-tab', 'guia-tab'];
        const currentTab = $('.content-tab.active').attr('id');
        const currentIndex = tabs.indexOf(currentTab);
        let newIndex = currentIndex + direction;
        
        if (newIndex < 0) newIndex = tabs.length - 1;
        if (newIndex >= tabs.length) newIndex = 0;
        
        $('.nav-item').removeClass('active');
        $(`.nav-item[data-tab="${tabs[newIndex]}"]`).addClass('active');
        $('.content-tab').removeClass('active');
        $(`#${tabs[newIndex]}`).addClass('active');
    }
    
    // Escuchar cambios en el tema del sistema
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        if ($('#autoDarkModeToggle').is(':checked')) {
            e.matches ? enableDarkMode() : disableDarkMode();
        }
    });
    
    // Cargar preferencias de color guardadas
    if (localStorage.getItem('primaryColor')) {
        changePrimaryColor(localStorage.getItem('primaryColor'));
    }
    
    // Deshabilitar zoom en dispositivos móviles
    document.addEventListener('gesturestart', function(e) {
        e.preventDefault();
    }, { passive: false });
});
    </script>
</body>
</html>
